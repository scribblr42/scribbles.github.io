---
layout: post
title: Nested LOD for Ranking
date: '2019-02-21T09:30:00.000Z'
author: VizScribbler
tags:
- level of detail
- lod
- tableau
- tableau desktop
modified_time: '2019-12-24T15:57:05.892Z'
blogger_id: tag:blogger.com,1999:blog-5138343082934398153.post-7458393264119610141
blogger_orig_url: https://vizscribbler.blogspot.com/2019/02/nested-lod-for-ranking.html
---

<i>This was originally posted on The Information Lab:&nbsp;https://www.theinformationlab.co.uk/2019/02/21/consultants-diary-nested-lod-for-ranking/</i><br /> <i><br /></i><br /><em>I’m going to try and share some of the techniques and methods I use as a consultant. Using Tableau &amp; Alteryx daily means that I’ve found I take small techniques, tips &amp; tricks for granted. Hopefully this will be useful for you all.</em><br /><i><br /></i><strong>Table&nbsp;calculations&nbsp;can&nbsp;be&nbsp;mysterious.</strong><br /><i><br /></i>When first learning about table calculations, it may be a tricky subject to wrap your head around. One of the most used table calculation is the RANK() function. Rank is a function which comes in many flavours...<br /><i><br /></i><figure class="wp-block-image"><img alt="" class="wp-image-12787" src="https://www.theinformationlab.co.uk/wp-content/uploads/2019/02/Screenshot-2019-02-14-at-22.21.50.png" /><figcaption> Yet another reason to pop open that calculation window when you first open a new version of Tableau.</figcaption></figure><i><br /></i><br />A customer had a very specific question, which they mocked up in the trusty Sample Superstore dataset:<br /><i><br /></i><em>How can I Rank this by Technology (because it has the highest selling subcategory (phones)) - then Furniture - then Office Supplies?</em><br /><i><br /></i><figure class="wp-block-image"><img alt="" class="wp-image-12788" src="https://www.theinformationlab.co.uk/wp-content/uploads/2019/02/Screenshot-2019-02-14-at-22.26.09.png" /></figure><i><br /></i><br />A normal rank function calculates that Phones are the highest, but moving the Basic Rank to the left of Category will rank based on Sub-Category.<br /><i><br /></i>So the method I thought of getting around this was using a nested level of detail calculation. The idea behind this was I wanted to create a field which took the highest value/maximum sales value for each Subcategory within each Category.<br /><i><br /></i>So I wanted to keep the total sales for each Subcategory, but cascade the maximum value within each Category.<br /><i><br /></i>Based on Andy Kriebel's excellent blog on <a href="http://www.vizwiz.com/2017/04/fixed-lod-pt1.html">understanding FIXED LoD calculations</a>, we can translate my solution into plain English.<br /><i><br /></i><figure class="wp-block-image"><img alt="" class="wp-image-12789" src="https://www.theinformationlab.co.uk/wp-content/uploads/2019/02/1549990889692.png" /></figure><i><br /></i><br />So with a { FIXED [Category] : MAX ( {INCLUDE [Sub-Category] : SUM([Sales])}) } we are saying...<br /><i><br /></i><strong>For each </strong>Category, <strong>compute the</strong> Maximum total sales for each sub-category.<br /><i><br /></i>This means that Tableau will first compute and return the values of the SUM(Sales) for each sub-category, and then take the maximum value from this partition for each category. <br /><br />The FIXED means that the value is returned per row within the category field. This then allows us to use this field with our RANK() table calculation.<br /><br /><figure class="wp-block-image"><img alt="" class="wp-image-12790" src="https://www.theinformationlab.co.uk/wp-content/uploads/2019/02/Screenshot-2019-02-14-at-22.46.56.png" /></figure><br /><div class="wp-block-file"><a href="https://www.theinformationlab.co.uk/wp-content/uploads/2019/02/Ranking_v10.2.twbx">Ranking_v10.2</a><a class="wp-block-file__button" download="" href="https://www.theinformationlab.co.uk/wp-content/uploads/2019/02/Ranking_v10.2.twbx">Download</a><br /><br /><span style="background-color: white; color: #191e23; font-family: &quot;Noto Serif&quot;; font-size: 16px; white-space: pre-wrap;">Feel free to crack open the workbook above to look under the hood of this example.</span></div>